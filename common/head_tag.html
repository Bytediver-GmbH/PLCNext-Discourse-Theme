<!-- PLCNext Community Header Theme -->
<meta name="theme-name" content="PLCNext Community Header Theme">
<meta name="theme-version" content="2.0.0">

<!-- PLCNext Header Template -->
<template id="plcnext-header-template">
  <div class="menu-wrapper" data-menu-wrapper>
    <header class="header-main">
      <div class="header-container">
        <div class="logo-section">
          <a href="https://www.plcnext-community.net" class="logo">
            <img src="https://www.plcnext-community.net/app/themes/plcnextcommunity/static/images/logo-plc-next.svg" alt="PLCnext Community" class="logo-image">
          </a>
        </div>

        <nav class="main-navigation">
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/infocenter/news" class="nav-link">News & Articles</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/about-plcnext-technology" class="nav-link">About PLCnext Technology</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/learning" class="nav-link">Learning</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/makers-blog" class="nav-link">Maker's Blog</a>
            </li>
            <li class="nav-item">
              <a href="/" class="nav-link nav-link-active">Forum</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/getting-started-with-plcnext-technology/#learn-more" class="nav-link nav-link-cta">Getting started</a>
            </li>
          </ul>
        </nav>

        <div class="header-controls">
          <a href="https://www.plcnext-community.net/?s=" target="_blank" class="search-toggle">
            <i class="icon-search"></i>
          </a>
          <button class="mobile-menu-toggle" data-burger>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
          </button>
        </div>
      </div>
    </header>

    <div class="mobile-overlay" data-mobile-nav>
      <div class="mobile-nav-content">
        <nav class="mobile-navigation">
          <ul class="mobile-nav-menu">
            <li><a href="https://www.plcnext-community.net/infocenter/news">News & Articles</a></li>
            <li><a href="https://www.plcnext-community.net/about-plcnext-technology">About PLCnext Technology</a></li>
            <li><a href="https://www.plcnext-community.net/learning">Learning</a></li>
            <li><a href="https://www.plcnext-community.net/makers-blog">Maker's Blog</a></li>
            <li><a href="/">Forum</a></li>
            <li><a href="https://www.plcnext-community.net/getting-started-with-plcnext-technology/#learn-more">Getting started</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</template>

<script>
function insertPLCNextHeader() {
    const existingHeader = document.querySelector('[data-menu-wrapper]');
    if (existingHeader) existingHeader.remove();

    const template = document.getElementById('plcnext-header-template');
    if (!template) return;

    const headerContent = template.content.cloneNode(true);
    const body = document.body;

    if (body.firstChild) {
        body.insertBefore(headerContent, body.firstChild);
    } else {
        body.appendChild(headerContent);
    }

    initializePLCNextHeader();
}

function initializePLCNextHeader() {
    const menuWrapper = document.querySelector('[data-menu-wrapper]');
    if (!menuWrapper) return;

    const mobileMenuToggle = menuWrapper.querySelector('[data-burger]');
    const mobileOverlay = menuWrapper.querySelector('[data-mobile-nav]');

    if (mobileMenuToggle && mobileOverlay) {
        mobileMenuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            const isActive = mobileOverlay.classList.contains('active');

            if (isActive) {
                mobileOverlay.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                mobileOverlay.classList.add('active');
                mobileMenuToggle.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        });

        mobileOverlay.addEventListener('click', function(e) {
            if (e.target === mobileOverlay) {
                mobileOverlay.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }

    window.addEventListener('resize', function() {
        if (window.innerWidth > 991) {
            mobileOverlay.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
            document.body.style.overflow = '';
        }
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', insertPLCNextHeader);
if (document.readyState !== 'loading') insertPLCNextHeader();

// Reinitialize on page changes for SPA
let lastUrl = location.href;
new MutationObserver(() => {
    const url = location.href;
    if (url !== lastUrl) {
        lastUrl = url;
        setTimeout(insertPLCNextHeader, 300);
    }
}).observe(document, { subtree: true, childList: true });
</script>

