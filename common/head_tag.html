<!-- PLCNext Community Header Theme -->
<meta name="theme-name" content="PLCNext Community Header Theme">
<meta name="theme-version" content="2.0.0">

<!-- PLCNext Header Template -->
<template id="plcnext-header-template">
  <div class="menu-wrapper" data-menu-wrapper>
    <header class="header-main">
      <div class="header-container">
        <div class="mobile-nav-left">
          <button class="btn btn-flat hamburger-dropdown no-text btn-icon" title="Open Menu" data-hamburger>
            <svg class="fa d-icon d-icon-bars svg-icon svg-string" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/>
            </svg>
          </button>
        </div>

        <div class="logo-section">
          <a href="https://www.plcnext-community.net" class="logo">
            <img src="https://www.plcnext-community.net/app/themes/plcnextcommunity/static/images/logo-plc-next.svg" alt="PLCnext Community" class="logo-image">
          </a>
        </div>

        <nav class="main-navigation">
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/infocenter/news" class="nav-link">News & Articles</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/about-plcnext-technology" class="nav-link">About PLCnext Technology</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/learning" class="nav-link">Learning</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/makers-blog" class="nav-link">Maker's Blog</a>
            </li>
            <li class="nav-item">
              <a href="/" class="nav-link">Forum</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/getting-started-with-plcnext-technology/#learn-more" class="nav-link nav-link-cta">Getting started</a>
            </li>
          </ul>
        </nav>

        <div class="header-controls">
          <a href="https://www.plcnext-community.net/?s=" target="_blank" class="search-toggle">
            <i class="icon-search"></i>
          </a>
          <a href="/u" class="user-toggle" title="User Menu">
            <i class="icon-user"></i>
          </a>
          <button class="mobile-menu-toggle" data-burger>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
          </button>
        </div>
      </div>
    </header>


    <!-- Mobile User Menu Overlay (Right) -->
    <div class="mobile-overlay" data-mobile-nav>
      <div class="mobile-nav-content">
        <nav class="mobile-navigation">
          <ul class="mobile-nav-menu">
            <li><a href="/u">My Account</a></li>
            <li><a href="/preferences">Preferences</a></li>
            <li><a href="/bookmarks">Bookmarks</a></li>
            <li><a href="/notifications">Notifications</a></li>
            <li><a href="/logout">Logout</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</template>

<script>
function insertPLCNextHeader() {
    const existingHeader = document.querySelector('[data-menu-wrapper]');
    if (existingHeader) existingHeader.remove();

    const template = document.getElementById('plcnext-header-template');
    if (!template) return;

    const headerContent = template.content.cloneNode(true);
    const body = document.body;

    if (body.firstChild) {
        body.insertBefore(headerContent, body.firstChild);
    } else {
        body.appendChild(headerContent);
    }

    initializePLCNextHeader();
}

function initializePLCNextHeader() {
    const menuWrapper = document.querySelector('[data-menu-wrapper]');
    if (!menuWrapper) return;

    const mobileMenuToggle = menuWrapper.querySelector('[data-burger]');
    const mobileOverlay = menuWrapper.querySelector('[data-mobile-nav]');

    // Discourse hamburger menu toggle functionality
    const hamburgerToggle = menuWrapper.querySelector('[data-hamburger]');
    if (hamburgerToggle) {
        hamburgerToggle.addEventListener('click', function(e) {
            e.preventDefault();

            // Find and click the actual Discourse hamburger menu button
            const discourseHamburger = document.querySelector('.hamburger-dropdown:not([data-hamburger])') ||
                                     document.querySelector('.btn-hamburger') ||
                                     document.querySelector('.toggle-hamburger-menu');

            if (discourseHamburger) {
                discourseHamburger.click();
            } else {
                // If no hamburger found, create and dispatch a custom event
                document.body.classList.toggle('hamburger-menu-visible');
            }
        });
    }

    // Mobile user menu functionality (right side)
    if (mobileMenuToggle && mobileOverlay) {
        mobileMenuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            const isActive = mobileOverlay.classList.contains('active');

            if (isActive) {
                mobileOverlay.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                mobileOverlay.classList.add('active');
                mobileMenuToggle.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        });

        mobileOverlay.addEventListener('click', function(e) {
            if (e.target === mobileOverlay) {
                mobileOverlay.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }

    window.addEventListener('resize', function() {
        if (window.innerWidth > 991) {
            if (mobileOverlay && mobileMenuToggle) {
                mobileOverlay.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', insertPLCNextHeader);
if (document.readyState !== 'loading') insertPLCNextHeader();

// Reinitialize on page changes for SPA
let lastUrl = location.href;
new MutationObserver(() => {
    const url = location.href;
    if (url !== lastUrl) {
        lastUrl = url;
        setTimeout(insertPLCNextHeader, 300);
    }
}).observe(document, { subtree: true, childList: true });
</script>

