<!-- PLCNext Community Header Theme - Head Tag -->
<meta name="theme-name" content="PLCNext Community Header Theme">
<meta name="theme-version" content="2.0.0">

<!-- Titillium Web font is imported in CSS -->

<!-- PLCNext Header Template -->
<template id="plcnext-header-template">
  <div class="menu-wrapper" data-menu-wrapper>
    <header class="header-main">
      <div class="header-container">
        <div class="logo-section">
          <a href="https://www.plcnext-community.net" class="logo">
            <img src="https://www.plcnext-community.net//app/themes/plcnextcommunity/static/images/logo-plc-next.svg" alt="PLCnext Community" class="logo-image">
          </a>
        </div>

        <nav class="main-navigation" data-navigation>
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/infocenter/news" class="nav-link">News & Articles</a>
            </li>
            <li class="nav-item has-submenu" data-submenu>
              <a href="https://www.plcnext-community.net/about-plcnext-technology" class="nav-link">About PLCnext Technology</a>
              <div class="submenu-overlay" data-overlay>
                <div class="submenu-content">
                  <div class="submenu-column">
                    <h4>Technology</h4>
                    <ul>
                      <li><a href="https://www.plcnext-community.net/about-plcnext-technology/overview">Overview</a></li>
                      <li><a href="https://www.plcnext-community.net/about-plcnext-technology/programming">Programming</a></li>
                      <li><a href="https://www.plcnext-community.net/about-plcnext-technology/connectivity">Connectivity</a></li>
                    </ul>
                  </div>
                  <div class="submenu-column">
                    <h4>Products</h4>
                    <ul>
                      <li><a href="https://www.plcnext-community.net/about-plcnext-technology/controllers">Controllers</a></li>
                      <li><a href="https://www.plcnext-community.net/about-plcnext-technology/software">Software</a></li>
                      <li><a href="https://www.plcnext-community.net/about-plcnext-technology/accessories">Accessories</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>
            <li class="nav-item has-submenu" data-submenu>
              <a href="https://www.plcnext-community.net/learning" class="nav-link">Learning</a>
              <div class="submenu-overlay" data-overlay>
                <div class="submenu-content">
                  <div class="submenu-column">
                    <h4>Getting Started</h4>
                    <ul>
                      <li><a href="https://www.plcnext-community.net/learning/getting-started">Quick Start</a></li>
                      <li><a href="https://www.plcnext-community.net/learning/tutorials">Tutorials</a></li>
                      <li><a href="https://www.plcnext-community.net/learning/examples">Examples</a></li>
                    </ul>
                  </div>
                  <div class="submenu-column">
                    <h4>Resources</h4>
                    <ul>
                      <li><a href="https://www.plcnext-community.net/learning/documentation">Documentation</a></li>
                      <li><a href="https://www.plcnext-community.net/learning/videos">Videos</a></li>
                      <li><a href="https://www.plcnext-community.net/learning/webinars">Webinars</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/makers-blog" class="nav-link">Maker's Blog</a>
            </li>
            <li class="nav-item">
              <a href="/" class="nav-link nav-link-active">Forum</a>
            </li>
            <li class="nav-item">
              <a href="https://www.plcnext-community.net/getting-started" class="nav-link nav-link-cta">Getting started</a>
            </li>
          </ul>
        </nav>

        <div class="header-controls" data-controls>
          <a href="https://www.plcnext-community.net/?s=" target="_blank" class="search-toggle">
            <i class="icon-search"></i>
          </a>
          <button class="mobile-menu-toggle" data-burger>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
            <span class="burger-line"></span>
          </button>
        </div>
      </div>
    </header>

    <div class="mobile-overlay" data-mobile-nav>
      <div class="mobile-nav-content">
        <nav class="mobile-navigation">
          <ul class="mobile-nav-menu">
            <li><a href="https://www.plcnext-community.net/infocenter/news">News & Articles</a></li>
            <li><a href="https://www.plcnext-community.net/about-plcnext-technology">About PLCnext Technology</a></li>
            <li><a href="https://www.plcnext-community.net/learning">Learning</a></li>
            <li><a href="https://www.plcnext-community.net/makers-blog">Maker's Blog</a></li>
            <li><a href="/">Forum</a></li>
            <li><a href="https://www.plcnext-community.net/getting-started">Getting started</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</template>

<script>
function insertPLCNextHeader() {
    // Remove any existing header first
    const existingHeader = document.querySelector('[data-menu-wrapper]');
    if (existingHeader) {
        existingHeader.remove();
    }

    // Get the template and clone it
    const template = document.getElementById('plcnext-header-template');
    if (!template) {
        console.error('PLCNext header template not found');
        return;
    }

    const headerContent = template.content.cloneNode(true);

    // Find the best insertion point (top of body)
    const body = document.body;
    const firstChild = body.firstChild;

    if (firstChild) {
        body.insertBefore(headerContent, firstChild);
    } else {
        body.appendChild(headerContent);
    }

    console.log('PLCNext header inserted successfully');

    // Initialize functionality after insertion
    setTimeout(() => {
        initializePLCNextHeader();
    }, 100);
}

function initializePLCNextHeader() {
    const menuWrapper = document.querySelector('[data-menu-wrapper]');
    if (!menuWrapper) {
        console.error('PLCNext menu wrapper not found after insertion');
        return;
    }

    // Elements
    const mobileMenuToggle = menuWrapper.querySelector('[data-burger]');
    const mobileOverlay = menuWrapper.querySelector('[data-mobile-nav]');
    const submenuItems = menuWrapper.querySelectorAll('[data-submenu]');

    // Mobile menu functionality
    if (mobileMenuToggle && mobileOverlay) {
        const newMobileToggle = mobileMenuToggle.cloneNode(true);
        mobileMenuToggle.parentNode.replaceChild(newMobileToggle, mobileMenuToggle);

        newMobileToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            const isActive = mobileOverlay.classList.contains('active');

            if (isActive) {
                mobileOverlay.classList.remove('active');
                newMobileToggle.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                mobileOverlay.classList.add('active');
                newMobileToggle.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        });

        // Close mobile menu on overlay click
        mobileOverlay.addEventListener('click', function(e) {
            if (e.target === mobileOverlay) {
                mobileOverlay.classList.remove('active');
                newMobileToggle.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }

    // Submenu hover functionality (desktop only)
    submenuItems.forEach(function(item) {
        const submenuOverlay = item.querySelector('[data-overlay]');
        if (!submenuOverlay) return;

        let hoverTimeout;

        item.addEventListener('mouseenter', function() {
            if (window.innerWidth > 991) {
                clearTimeout(hoverTimeout);
                submenuOverlay.style.opacity = '1';
                submenuOverlay.style.visibility = 'visible';
                submenuOverlay.style.transform = 'translateX(-50%) translateY(0)';
            }
        });

        item.addEventListener('mouseleave', function() {
            if (window.innerWidth > 991) {
                hoverTimeout = setTimeout(function() {
                    submenuOverlay.style.opacity = '0';
                    submenuOverlay.style.visibility = 'hidden';
                    submenuOverlay.style.transform = 'translateX(-50%) translateY(-10px)';
                }, 150);
            }
        });
    });

    // Handle window resize
    window.addEventListener('resize', function() {
        // Close mobile menu on resize to desktop
        if (window.innerWidth > 991) {
            mobileOverlay.classList.remove('active');
            document.querySelector('[data-burger]').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Hide submenus on mobile
        if (window.innerWidth <= 991) {
            submenuItems.forEach(function(item) {
                const submenuOverlay = item.querySelector('[data-overlay]');
                if (submenuOverlay) {
                    submenuOverlay.style.opacity = '0';
                    submenuOverlay.style.visibility = 'hidden';
                }
            });
        }
    });

    // Add loading animation
    menuWrapper.style.opacity = '0';
    menuWrapper.style.transform = 'translateY(-20px)';

    setTimeout(function() {
        menuWrapper.style.transition = 'all 0.6s ease';
        menuWrapper.style.opacity = '1';
        menuWrapper.style.transform = 'translateY(0)';
    }, 100);

    console.log('PLCNext Community Header initialized successfully');
}

// Initialize header on page load
document.addEventListener('DOMContentLoaded', function() {
    insertPLCNextHeader();
});

// Also try to initialize immediately if DOM is already ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', insertPLCNextHeader);
} else {
    insertPLCNextHeader();
}

// Reinitialize on page changes (for SPA behavior)
let lastUrl = location.href;
new MutationObserver(() => {
    const url = location.href;
    if (url !== lastUrl) {
        lastUrl = url;
        setTimeout(() => {
            insertPLCNextHeader();
        }, 500);
    }
}).observe(document, { subtree: true, childList: true });

// Analytics tracking (optional)
function trackHeaderClick(element, action) {
    if (typeof gtag !== 'undefined') {
        gtag('event', 'click', {
            'event_category': 'Header Navigation',
            'event_label': element,
            'value': action
        });
    }
}
</script>

<!-- Custom CSS for icon fonts -->
<style>
.icon-search::before {
    content: "";
    display: inline-block;
    width: 18px;
    height: 18px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'%3E%3C/path%3E%3C/svg%3E");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

.icon-close::before {
    content: "";
    display: inline-block;
    width: 16px;
    height: 16px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'%3E%3C/path%3E%3C/svg%3E");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

/* Ensure proper font loading */
.menu-wrapper {
    font-display: swap;
}

/* Preload critical resources */
.menu-wrapper::before {
    content: '';
    position: absolute;
    top: -9999px;
    left: -9999px;
    background: url('https://www.plcnext-community.net//app/themes/plcnextcommunity/static/images/logo-plc-next.svg') no-repeat;
    width: 1px;
    height: 1px;
}
</style>