<!-- PLCNext Community Header Theme -->
<meta name="theme-name" content="PLCNext Community Header Theme">
<meta name="theme-version" content="2.0.0">

<!-- PLCNext Navigation Template -->
<template id="plcnext-header-template">
  <nav class="main-navigation">
    <ul class="nav-menu">
      <li class="nav-item">
        <a href="{{header_news_url}}" class="nav-link">{{header_news_text}}</a>
      </li>
      <li class="nav-item">
        <a href="{{header_about_url}}" class="nav-link">{{header_about_text}}</a>
      </li>
      <li class="nav-item">
        <a href="{{header_learning_url}}" class="nav-link">{{header_learning_text}}</a>
      </li>
      <li class="nav-item">
        <a href="{{header_blog_url}}" class="nav-link">{{header_blog_text}}</a>
      </li>
      <li class="nav-item">
        <a href="/" class="nav-link">{{header_forum_text}}</a>
      </li>
      <li class="nav-item">
        <a href="{{header_getting_started_url}}" class="nav-link nav-link-cta">{{header_getting_started_text}}</a>
      </li>
    </ul>
  </nav>
</template>

<!-- PLCNext Footer Template -->
<template id="plcnext-footer-template">
  <footer class="plcnext-footer" id="plcnext-footer">
    <div class="footer-container">
      <nav class="footer-navigation">
        <a href="{{footer_legal_url}}" class="footer-link">{{footer_legal_text}}</a>
        <a href="{{footer_site_notice_url}}" class="footer-link">{{footer_site_notice_text}}</a>
        <a href="{{footer_privacy_url}}" class="footer-link">{{footer_privacy_text}}</a>
      </nav>
	    <div class="footer-logo">
		    <a href="{{footer_phoenix_url}}">
			    <img src="https://www.plcnext-community.net//app/themes/plcnextcommunity/static/images/logo-phoenix-contact.svg" alt="Phoenix Contact" class="footer-logo-image">
		    </a>
	    </div>
    </div>
  </footer>
</template>

<script>
// Get theme settings
const settings = {
    header_news_url: '<%= theme_setting("header_news_url") %>',
    header_news_text: '<%= theme_setting("header_news_text") %>',
    header_about_url: '<%= theme_setting("header_about_url") %>',
    header_about_text: '<%= theme_setting("header_about_text") %>',
    header_learning_url: '<%= theme_setting("header_learning_url") %>',
    header_learning_text: '<%= theme_setting("header_learning_text") %>',
    header_blog_url: '<%= theme_setting("header_blog_url") %>',
    header_blog_text: '<%= theme_setting("header_blog_text") %>',
    header_forum_text: '<%= theme_setting("header_forum_text") %>',
    header_getting_started_url: '<%= theme_setting("header_getting_started_url") %>',
    header_getting_started_text: '<%= theme_setting("header_getting_started_text") %>',
    footer_legal_url: '<%= theme_setting("footer_legal_url") %>',
    footer_legal_text: '<%= theme_setting("footer_legal_text") %>',
    footer_site_notice_url: '<%= theme_setting("footer_site_notice_url") %>',
    footer_site_notice_text: '<%= theme_setting("footer_site_notice_text") %>',
    footer_privacy_url: '<%= theme_setting("footer_privacy_url") %>',
    footer_privacy_text: '<%= theme_setting("footer_privacy_text") %>',
    footer_phoenix_url: '<%= theme_setting("footer_phoenix_url") %>'
};

function insertPLCNextHeader() {
    // Wait for Discourse header to be available
    const discourseHeader = document.querySelector('#site-header') || document.querySelector('.d-header');
    if (!discourseHeader) {
        setTimeout(insertPLCNextHeader, 500);
        return;
    }

    // Remove existing PLCNext modifications
    const existingPLCNext = discourseHeader.querySelector('.plcnext-navigation');
    if (existingPLCNext) existingPLCNext.remove();

    // Add PLCNext navigation with theme settings
    const template = document.getElementById('plcnext-header-template');
    if (!template) return;

    let templateHTML = template.innerHTML;

    // Replace placeholders with theme settings
    templateHTML = templateHTML
        .replace(/\{\{header_news_url\}\}/g, settings.header_news_url)
        .replace(/\{\{header_news_text\}\}/g, settings.header_news_text)
        .replace(/\{\{header_about_url\}\}/g, settings.header_about_url)
        .replace(/\{\{header_about_text\}\}/g, settings.header_about_text)
        .replace(/\{\{header_learning_url\}\}/g, settings.header_learning_url)
        .replace(/\{\{header_learning_text\}\}/g, settings.header_learning_text)
        .replace(/\{\{header_blog_url\}\}/g, settings.header_blog_url)
        .replace(/\{\{header_blog_text\}\}/g, settings.header_blog_text)
        .replace(/\{\{header_forum_text\}\}/g, settings.header_forum_text)
        .replace(/\{\{header_getting_started_url\}\}/g, settings.header_getting_started_url)
        .replace(/\{\{header_getting_started_text\}\}/g, settings.header_getting_started_text);

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = templateHTML;
    const plcnextNav = tempDiv.querySelector('.main-navigation');

    if (plcnextNav) {
        plcnextNav.classList.add('plcnext-navigation');

        // Try different insertion points
        const headerContents = discourseHeader.querySelector('.contents') ||
                             discourseHeader.querySelector('.wrap') ||
                             discourseHeader;

        const insertionPoint = headerContents.querySelector('.panel') ||
                             headerContents.querySelector('.header-buttons') ||
                             headerContents.querySelector('.auth-buttons') ||
                             headerContents.lastElementChild;

        if (insertionPoint) {
            insertionPoint.parentNode.insertBefore(plcnextNav, insertionPoint);
        } else {
            headerContents.appendChild(plcnextNav);
        }
    }

    // Replace logo
    replaceLogo();

    // Insert footer
    insertPLCNextFooter();

    initializePLCNextHeader();
}

function replaceLogo() {
    // Find all possible logo elements
    const logoSelectors = [
        '#site-header .logo-mobile img',
        '#site-header .title a',
        '.d-header .logo-mobile img',
        '.d-header .title a',
        '#site-header .logo img',
        '.d-header .logo img'
    ];

    logoSelectors.forEach(selector => {
        const logoElements = document.querySelectorAll(selector);
        logoElements.forEach(element => {
            if (element.tagName === 'IMG') {
                element.src = 'https://www.plcnext-community.net/app/themes/plcnextcommunity/static/images/logo-plc-next.svg';
                element.alt = 'PLCnext Community';
                element.style.height = '45px';
                element.style.width = 'auto';
            } else if (element.tagName === 'A') {
                element.href = 'https://www.plcnext-community.net';

                // Check if it contains an img
                const img = element.querySelector('img');
                if (img) {
                    img.src = 'https://www.plcnext-community.net/app/themes/plcnextcommunity/static/images/logo-plc-next.svg';
                    img.alt = 'PLCnext Community';
                    img.style.height = '45px';
                    img.style.width = 'auto';
                }

                // If it's a text-based title, replace the text
                if (!img && element.textContent) {
                    element.innerHTML = '<img src="https://www.plcnext-community.net/app/themes/plcnextcommunity/static/images/logo-plc-next.svg" alt="PLCnext Community" style="height: 45px; width: auto;">';
                }
            }
        });
    });
}

function insertPLCNextFooter() {
    // Remove existing footer
    const existingFooter = document.querySelector('#plcnext-footer');
    if (existingFooter) existingFooter.remove();

    // Add PLCNext footer with theme settings
    const template = document.getElementById('plcnext-footer-template');
    if (!template) return;

    let templateHTML = template.innerHTML;

    // Replace placeholders with theme settings
    templateHTML = templateHTML
        .replace(/\{\{footer_legal_url\}\}/g, settings.footer_legal_url)
        .replace(/\{\{footer_legal_text\}\}/g, settings.footer_legal_text)
        .replace(/\{\{footer_site_notice_url\}\}/g, settings.footer_site_notice_url)
        .replace(/\{\{footer_site_notice_text\}\}/g, settings.footer_site_notice_text)
        .replace(/\{\{footer_privacy_url\}\}/g, settings.footer_privacy_url)
        .replace(/\{\{footer_privacy_text\}\}/g, settings.footer_privacy_text)
        .replace(/\{\{footer_phoenix_url\}\}/g, settings.footer_phoenix_url);

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = templateHTML;
    const footerContent = tempDiv.firstElementChild;

    // Insert footer at the very end of the body, after all Discourse content
    document.body.appendChild(footerContent);
}


function initializePLCNextHeader() {
    // Since we're now using the original Discourse header, we don't need custom functionality
    // The hamburger menu and user menu will work automatically with Discourse's built-in functionality
}

// Initialize
document.addEventListener('DOMContentLoaded', insertPLCNextHeader);
if (document.readyState !== 'loading') insertPLCNextHeader();

// Reinitialize on page changes for SPA
let lastUrl = location.href;
new MutationObserver(() => {
    const url = location.href;
    if (url !== lastUrl) {
        lastUrl = url;
        setTimeout(insertPLCNextHeader, 300);
    }
}).observe(document, { subtree: true, childList: true });
</script>

